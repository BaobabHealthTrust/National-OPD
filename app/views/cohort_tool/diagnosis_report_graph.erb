<html>
	<head>
		<script language="javascript" type="text/javascript" src="/javascripts/flotr2.min.js"></script>
		<script type="text/javascript">
	function drawBarChart() {

	var d2 = [], markers = [], i = 0, highest=0;
				
	var container = document.getElementById('barChart'),graph,d1 = [];
	
		 <% @diagnosis_report_paginated.each do |diagnosis,total| %>
		          d2.push([i,<%= "#{total}".to_json %>]);
		          if ( highest < <%= "#{total}".to_json %>)
		              		highest = <%= "#{total}".to_json %> ;
		          
		          markers.push([<%= "#{diagnosis}".to_json %>]);
		          d1.push([i,"D"+i]);
		          i +=1;
		  <% end %>
							
          // Draw Graph
          graph = Flotr.draw(container,[d2],{ bars: {show:true, barWidth:0.5}, xaxis: { ticks: d1, min:0, max: d2.length}, yaxis:{min:0, max:8000}, mouse: {track: true}});
				
				//fill up the legend

				var legend = document.getElementById("legend");
				var string = "";
				for (x=0; x < markers.length; x++)
						string = string +"D" +x +"=" + markers[x] + "<br>"
						
				legend.innerHTML =  string		
				
      };
		setTimeout("drawBarChart();",300)      
		
		function drawPieChart(){
					
		var d2 = [], markers = [], i = 0, highest=0;		
		var container = document.getElementById('barChart'),graph,d1 = [];
	
		 <% @diagnosis_report_paginated.each do |diagnosis,total| %>
		          d2.push([i,<%= "#{total}" %>]);
		          markers.push([<%= "#{diagnosis}".to_json %>]);
		   
		          i +=1;
		  <% end %>
							
          // Draw Graph
      graph = Flotr.draw(container,d2, {
        HtmlText: false,
        grid: {
            verticalLines: false,
            horizontalLines: false
        },
        xaxis: {
            showLabels: false
        },
        yaxis: {
            showLabels: false
        },
        pie: {
            show: true,
            
        },
        mouse: {
            track: true
        },
        legend: {
            position: 'se',
            backgroundColor: '#D2E8FF'
        }
    });
				

		};
		
		function chartType() {
			var chart = document.getElementById("type");
			
			if (type.innerHTML == "<span>Pie Chart</span>")
			{
				type.innerHTML = "<span>Bar Chart</span>"
				drawPieChart();
			}
			else
			{
				type.innerHTML = "<span>Pie Chart</span>"
				drawBarChart();
			
			}			
		
		}
		
		function chartTypeButton() {
		
			var button = document.getElementById("buttons");
			var type = document.createElement("button")
			type.innerHTML="<span>Pie Chart</span>"
			type.setAttribute("id", "type")
			type.setAttribute("class","blue")
			type.setAttribute("onclick", "chartType()")
			button.appendChild(type)

		}
		setTimeout("chartTypeButton();",300)
</script >

	</head>
	
	
  <body >
    <%= image_tag(@logo, :class => "logo")%>
    <br />
<div style= " position:absolute;top:30px; left:150px">

		<b><%= @current_location_name %><br />
    <%= @report_name.humanize.split.map{|w| w.capitalize}.join(' ') %>
    <br /> Dates : <%= "#{@formated_start_date} to #{@formated_end_date}"%> 
    <br/>Group (s) : <%= "#{@age_groups.join(' , ').to_s}" %>  </b><br>
    <span style= "text-align:right;"><b>Legend</b></span>
</div>

<div style = "border: 1px solid; height: 480px; width:80%; margin-left:30px; overflow:auto;" id="barChart">

</div>

<div id = "legend" style = "border:1px solid; height:480px; width:15%; overflow:auto; position: relative; top:-482px; left: 83%;">

</div>



	</body>
</html>
